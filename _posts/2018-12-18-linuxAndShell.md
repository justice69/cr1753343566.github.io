---
layout: post                  
title: "linux命令Shell脚本"             
date: 2018-12-18           
tag: Java基础
---

## linux操作系统

Minix--->linux

linux是一种自由和开源的类unix系统，linux指基于linux内核的完整操作系统，包括多种GUI组件和其他工具
GNU通用公共许可协议，是一个广泛被使用的自由软件许可协议条款，GNU给予计算机程序自由软件的定义，任何基于GPL软件开发衍生的产品在发布时必须采用GPL许可证方式，且必须公开源代码
Linux是自由软件和开放源代码软件发展种最著名的例子。只要遵循GNU通用许可证，任何个人和机构都可以自由的使用linux的所有底层源代码，也可以修改和再发布。随着Linux操作系统的发展，各种集成在Linux上的开源软件和实用工具也得到了应用和普及。

Linux在服务器领域具有绝对地位。

Linux下基本指令

### ls [选项][目录文件]
        
对于目录，列出该目录下的所有子目录和文件。对于文件，列出文件名以及其他信息

- -a 列出目录下所有文件，包括 . 开头的隐含文件
- -d [ls -d+指定的目录]将目录像文件一样显示，而不显示其下的文件
- -i 输出文件的i结点的索引信息
    
    <img src="./images/ls-ai.PNG">

- -k [ls -alk]以k字节的形式表示文件大小
- -l 列出文件的详细信息
- -n 用数字的UID,GID代替名称
- -F 在每个文件名后附一个字符以说明文件的类型(目录类型识别)"*"表示可执行的普通文件；"/"表示目录；"@"表示符号链接,"l"表示FIFOs；"="表示套接字
    
    <img src="./images/ls-F.PNG">

- -r 对目录反向排序

    <img src="./images/ls-r.PNG">

- -s 在l文件名后输出该文件的大小
- -R 递归出所有子目录下的文件
- -1 一行只输出一个文件

### pwd 显示用户当前所在的目录 

    <img src=./images/pwd.PNG>

### cd 改变工作目录。将当前目录改变到指定的目录下

- cd .. 返回上级目录
- cd /home/shh/shh 绝对路径
- cd ../Public 相对路径
- cd ~:进入用户目录
- cd -:返回最近访问目录

### touch [选项]... 文件... touch命令参数可更改文档或目录的日期时间，包括存取时间和更改时间，或者新建一个不存在的文件

- -a 只更改存取时间
- -c 不建立任何文档
- -d 使用指定的日期时间，而非现在的时间
- -m 只更改变动时间
- -r 把指定文档或目录的日期时间，统一设置为和参考文档或目录的日期时间相同
- -t 使用指定的日期时间，而非现在的时间

### mkdir + 文件名 在当前目录下创建一个目录

- -p 可以是一个路径名称，此时路径中的某些目录尚不存在，加上后，将自动创建那些尚不存在的目录

mkdir -p test/test/  递归创建多个目录

### rmdir 删除空目录  

- rmdir [-p]+文件名 删除空目录(目录中有其他空目录不能删除)

### rm 删除文件或目录  

- -f 即使文件属性为只读也删除 
- -i 删除前确认
- -r 删除目录及其下所有文件
- rm -rf +文件名 递归删除目录及其下所有文件

### man指令 查看联机手册获取帮助

- -k 根据关键字搜索联机帮助

### cp[选项] 源文件或目录 目标文件或目录 复制文件或目录

***cp指令用于复制文件或目录，如同时指定两个以上的文件或目录，且最后一的目的地是一个已经存在的目录，则它会把前面指定的所有文件或目录复制到此目录中。若最后的目的地并非一个已存在的目录，则会出错***

- -f 强行复制文件或目录，不论目的文件或目录是否已经存在
- -i 覆盖文件之前先询问用户
- -r 递归处理，将指定目录下的文件与子目录一并处理。若源文件或目录的形态，不属于目录或符号链接，则一律按普通文件处理

### mv[选项]源文件或目录 目标文件或目录

- -f : 如果目标文件已存在，不会询问而直接覆盖
- -i ：若目标文件已经存在时，就会询问是否覆盖
-  mv A B : 将A目录重命名为B

***当B参数是已存在的目录名称时，源文件或目录参数可以有多个，mv命令将各参数指定的源文件均移至目标目录中***

### cat/tac cat[选项]文件

- -b 对非空输出行 编号
- -n 对输出的所有行编号
- -s  不输出多行空行

### more 类似cat more[选项][文件]

- -n 一页显示的行数，按空格显示下一页
- -q 退出more
- -p 不以卷动的方式显示每一页，而是先清除萤幕后再显示内容
- -s 当遇到有连续两行以上的空白行，就代换为一行的空白行
- +num 从第 num 行开始显示

### less less[参数] 文件

- -i 忽略搜索时的大小写
- -N 显示每行的行号
- /字符串 向下搜索字符串
- ?字符串 向上搜索字符串

***less比起more更具有弹性，使用less可以向前向后翻，less支持向下搜和向上搜的功能***

### head 用来显示开头或结尾某个数量的文字区块

### tail [必要参数][选择参数][文件]

- -f 循环读取
- -n<行数> 显示行数

***从指定点开始将文件写到标准输出,使用tail命令的-f选项可以方便的查阅正在改变的日志文件***

### find -name Linux下find命令在目录结构中搜索文件，并执行指定的操作

### gre [选项] 搜索字符串 文件

- -i :忽略大小写的不同
- -n 顺便输出行号
- -v 反向选择，排除拥有搜索字符串的那一行

### tar  打包解包不打开直接查看

- -c 建立一个压缩文件
- -x 解开一个压缩文件
- -t 查看tar的内容
- -z 是否具有gzip的属性
- -j 是否同时具有bzip属性
- -v 压缩的过程显示文件
- -f 使用档名 f后接档名
- -C 解压到指定目录

### uname-r 用来获取电脑和操作系统的相关信息

- -a 显示linux主机所有的操作系统的版本、应键的名称等基本信息依次为内核名称，主机名，内核版本号，内核版本，硬件名，处理器类型，硬件平台类型，操作系统名称

### 关机 shutdown[选项]

- -h : 将系统的服务停掉后，立即关机
- -r ：将系统的服务停掉之后就重新启动
- -t sec 后面加秒数，即过几秒关机

## Shell

shell 是一种用C语言编写的程序，是用户使用linux的桥梁。shell既是一种命令语言，又是一种程序设计语言。

Shell是指一种应用程序，这个应用程序提供了一个界面，用户通过这个界面访问操作系统内核的服务

### Shell脚本

Shell脚本，是一种为shell编写的脚本程序

新建一个文本文件，保存扩展名为 **.sh** 

    #!/bin/bash
    echo "Hello World !"

"#！"是一个约定标记，它告诉系统这个脚本需要用什么解释器来执行，即使用哪一种shell

### 运行shell脚本：

**1.将上面的代码保存为 test.sh，并cd到相应目录下**

    chmod +x ./test.sh  #使脚本具有执行权限
    ./test.sh  #执行脚本

**2.作为解释器参数：直接运行解释器，其参数就是shell脚本的文件名**

    /bin/sh test.sh

这种方式运行的脚本，不需要在第一行在指定解释器信息

## Shell变量

### 定义变量时，变量名不加美元符号

    your_name="cristiano"

定义变量时命名必须遵循如下规则：

1. 命名只能用英文字母，数字和下划线，首字符不能以数字开头
2. 中间不能有空格，可以使用下划线
3. 不能有标点符号
4. 不能使用bash里的关键字

### 使用变量 

使用定义过的变量时，在变量名前面加美元符号即可，变量名外的花括号可选，帮助解释器是识别变量边界

### 只读变量

使用**readonly**命令可以将变量定义为只读变量，只读变量的值不能被改变    

    声明为只读变量：readonly+变量名

### 删除变量(unset命令不能删除只读变量)

    unset +变量名

### 变量类型

- 局部变量 局部变量在脚本或命令中定义，仅在当前shell实例中有效，其他shell启动的程序不能访问局部变量
- 环境变量 所有的程序，包括shell启动的程序，都能访问环境变量，有些程序需要环境变量来保证其正常运行。必要的时候shell脚本也可以定义环境变量
- shell变量 shell变量是由shell程序设置的特殊变量。shell变量中有一部分是环境变量，有一部分是局部变量，这些变量保证了shell的正常运行

## Shell字符串

字符串是shell编程中最常用最有用的数据类型，字符串可以用单引号，也可以用双引号，也可以不用引号

### 单引号

    str='this is a string'

单引号的字符串限制：
1. 单引号里的任何字符都会原样输出，单引号字符串中的变量是无效的；
2. 单引号字串中不能出现单独一个的单引号（对单引号使用转义符后也不行），但可成对出现，作为字符串拼接使用

### 双引号

    your_name="messi"
    str="Hello, \"$your_name\"!"
    echo $str
    输出：Hello,"messi"!

1. 双引号里可以有变量
2. 双引号里可以出现转义字符

### 拼接字符串

双引号拼接：

    your_name="runoob"
    greeting="hello, "$your_name" !"
    greeting_1="hello, ${your_name} !"
    echo $greeting  $greeting_1
    输出：hello, runoob ! hello, runoob !

单引号拼接：

    greeting_2='hello, '$your_name' !'
    greeting_3='hello, ${your_name} !'
    echo $greeting_2  $greeting_3
    输出：hello, runoob ! hello, ${your_name} !

单引号内的字符都会被原样输出

### 字符串操作

- 获取字符串长度

        string="abc"
        echo ${#string}
        输出：3 
- 截取字符串：变量名:x:y 排除x个截取y个 空字符也算进去

        string="my favorite football player is cristiano"
        echo ${string:1:4}
        输出：y fa
- 查找子字符串
        
        string="my favorite football player is cristiano"
        echo `expr index "$string" yal`

## Shell数组

bash支持一维数组,并且没有限定数组的大小。数组元素的下标由0开始编号。获取数组中的元素要利用下标，下标可以是整数或算术表达式，其值大于等于0

### 定义数组

Shell中，用括号来表示数组，数组元素用"空格"符号隔开。定义的数组一般形式为

    数组名=(值1 值2...值n)
    array=(value0 value1 value2)

数组可以不使用连续的下标，而且下标的范围没有限制

### 读取数组

    ${数组名[下标]}
    ${array[2]}

使用@符号可以获取数组中所有元素
    
    echo ${array[@]}

### 获取数组长度

    length=${#array[@]}
    length=${#array[*]}

取得数组单个元素的长度
    
    length=${#array[n]}
    
## Shell注释

- 单行注释:#
- 多行注释: :
    
        <<EOF
        注释内容...
        EOF

## Shell传参

脚本获取参数的格式为:$n。n代表第n个参数

参数传递:(给test.sh传递3个参数 1 2 3)

    ./test.sh 1 2 3

- $0 为执行的文件名
- $# 传递到脚本的参数个数
- $* 以一个字符串显示所有向脚本传递的参数
- $$ 脚本运行的当前进程ID号
- $! 后台运行的最后一个进程的ID号
- $@ 与$*相同，但是使用时加引号，并在引号中返回每个参数
- $- 显示Shell使用的当前选项，与set命令功能相同
- $? 显示最后命令的退出状态。0表示没有错误，其他任何值表示有错误

$*与$@的区别：

相同点:都是引用所有参数

不同点:只有在双引号中体现出来 **[假设在脚本运行时写了三个参数 1、2、3，，则 " * " 等价于 "1 2 3"（传递了一个参数），而 "@" 等价于 "1" "2" "3"（传递了三个参数）。]**

## Shell基本运算符

- 算数运算符
- 关系运算符
- 布尔运算符
- 字符串运算符
- 文件测试运算符

原生bash不支持简单的数学运算，但是可以使用其他命令来实现，例如awk expr expr最常用

    使用两个数相加：
    val=`expr 2 + 2`
    echo "两数之和为 : $val"

表达式与运算符之间要有空格，例如 ***2+2*** 是不对的，必须写成 ***2 + 2***
完整的表达式要被``包含

### 算数运算符

<img src="./img/ss.PNG">

**乘号(*)前边必须加反斜杠(\)才能实现乘法运算**

### 关系运算符

关系运算符只支持数字，不支持字符串，除非字符串的值是数字

1. -eq 检测两个数是否相等，相等返回true
2. -ne 检测两个数是否不相等，不相等返回true
3. -gt 检测左边的数是否大于右边的，大于返回true
4. -lt 检测左边的数是否小于右边的，小于返回true
5. -ge 检测左边的数是否大于等于右边的，满足返回true
6. -le 检测左边的数是否小于等于右边的，满足返回true

### 布尔运算符

1. ! 非运算，表达式为true返回false，表达式为false返回true
2. -o 或运算，有一个表达式为true则返回true
3. -a 与运算，两个表达式都为true才返回true

### 逻辑运算符

$$ 逻辑与 
|| 逻辑或

### 字符串运算符

1. **=** 检测两个字符串是否相等，相等返回 true
2. **!=** 检测两个字符串是否相等，不相等返回 true
3. **-z** 检测字符串长度是否为0，为0返回true
4. **-n** 检测字符串长度是否为0，不为0返回true
5. **str** 检测字符串长度是否为空。不为空返回true

### 文件测试

1. -e文件名 存在为真
2. -r文件名 存在且可读为真
3. -w文件名 存在且可写为真
4. -x文件名 存在且可执行为真
5. -s文件名 存在且至少有一个字符为真
6. -d文件名 存在且为目录为真
7. -f文件名 存在且为普通文件为真
8. -c文件名 存在且为字符型特殊文件为真
9. -b文件名 存在且为块特殊文件为真

## Shell echo命令

1. 显示普通字符串(双引号可省略)

        echo "It is a test"
        echo It is a test
2. 显示转义字符

        echo "\"It is a test\""

3. 显示变量 read命令从标准输入中读取一行，并把输入行的字段的值指定给shell变量

        #!/bin/sh
        read name 
        echo "$name It is a test"
        控制台运行
        Ok
        Ok It is a test

4. 显示换行

        echo -e "OK! \n"

5. 显示不换行

        echo -e "OK! \c"

6. 显示结果定向至文件(如果文件有内容将清空文件内容输入echo的内容)

        echo "It is a test" > mufile

7. 原样输出字符串，不进行转移或取变量

        echo '$name\"'

8. 显示命令执行结果(显示当前时间)

        echo `date`

**read 命令一个一个词组地接收输入的参数，每个词组需要使用空格进行分隔；如果输入的词组个数大于需要的参数个数，则多出的词组将被作为整体为最后一个参数接收**

    read -p "请输入一段文字:" -n 6 -t 5 -s password
    echo -e "\npassword is $password"

1. -p 输入提示文字
2.  -n 输入字符长度限制(达到6位，自动结束)
3. -t 输入限时
4. -s 隐藏输入内容
        
## printf

printf 使用引用文本或空格分隔的参数，外面可以在 printf 中使用格式化字符串，还可以制定字符串的宽度、左右对齐方式等。默认 printf 不会像 echo 自动添加换行符，我们可以手动添加 \n

    printf format-string [arguments...]

format-string:为格式控制字符串

arguments:为参数列表

%s %c %d %f都是格式替代符

- d: Decimal 十进制整数 -- 对应位置参数必须是十进制整数，否则报错！
- s: String 字符串 -- 对应位置参数必须是字符串或者字符型，否则报错！
- c: Char 字符 -- 对应位置参数必须是字符串或者字符型，否则报错！
- f: Float 浮点 -- 对应位置参数必须是数字型，否则报错！

## Shell test命令 检查某个条件是否成立，可以与数值、字符和文件三个方面的测试

### 数字测试

与关系运算符配合使用

    if test $[num1] -eq $[num2]
    then
        echo '两个数相等！'
    else
        echo '两个数不相等！'
    fi

### 字符串测试

与字符串运算符配合使用

    if test $num1 = $num2
    then
        echo '两个字符串相等!'
    else
        echo '两个字符串不相等!'
    fi

### 文件测试

与文件运算符配合使用

    if test -e ./bash
    then
        echo '文件已存在!'
    else
        echo '文件不存在!'
    fi  

## Shell流程控制

### if-else

sh/bash里，如果else分支没有语句可执行，就不要写else

    if condition1
    then
        command1
    elif condition2 
    then 
        command2
    else
        commandN
    fi

### for循环

    for var in item1 item2 ... itemN
    do
        command1
        command2
        ...
        commandN
    done

### while语句

    while condition
    do
        command
    done

### 无限循环

    while :
    do
        command
    done

### util循环

until 循环执行一系列命令直至条件为 true 时停止。

    until condition
    do
        command
    done

### case 选择语句

    case 值 in
    模式1)
        command1
        command2
        ...
        commandN
        ;;
    模式2）
        command1
        command2
        ...
        commandN
        ;;
    esac

case工作方式如上所示。取值后面必须为单词in，每一模式必须以右括号结束。取值可以为变量或常数。匹配发现取值符合某一模式后，其间所有命令开始执行直至 ;;,如果没有匹配则使用*号捕获该值，再执行后面的命令

### 跳出循环

- break命令允许跳出所有循环（终止执行后面的所有循环）
- continue命令与break命令类似，只有一点差别，它不会跳出所有循环，仅仅跳出当前循环

## Shell函数

shell中函数的定义如下：

    [function] funname[()]
    {
        action;
        [return int;]
    }

没有return的函数将以最后一条命令运行结果作为返回值

有return的函数返回值在调用该函数后通过$?来获得

当参数传递后获取参数，当第n个参数，n>=10时，需要运用${n}来获取参数

## Shell输入/输出重定向

一个命令通常从一个叫标准输入的地方读取输入，默认情况下，这恰好是你的终端。同样，一个命令通常将其输出写入到标准输出，默认情况下，这也是你的终端

- command>file 将输出重定向到file
- command<file 将输入重定向到file
- command>>file 将输出以追加的方式重定向到file
- n>file 将文件描述为n的文件重定向到file
- n>>file 将文件描述为n的文件以追加的方式重定向到file
- n>$m 将输出文件m和n合并
- n<$m 将输入文件m和n合并
- << tag 将开始标记tag和结束标记tag之间的内容作为输出


shell脚本式实现开机自启动nexus

